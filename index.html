<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Cycle Tracker</title>
  <style>
    @font-face {
      font-family: 'HJSS';
      src: url('HJSS.ttf') format('truetype');
    }
    :root {
      --shade-period: #f4dfe4;
      --circle-color: #E1a3b3;
      --shade-ovulation: #b5c0e3;
    }
    * { box-sizing:border-box; margin:0; padding:0 }
    body {
      display:flex; align-items:center; justify-content:center;
      height:100vh; background:#f9f9f9; font-family:'HJSS',sans-serif;
    }
    .wrapper {
      width:100%; max-width:400px; background:#fff;
      border-radius:8px; padding:1rem;
      box-shadow:0 2px 8px rgba(0,0,0,0.1);
    }
    header {
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom:1rem;
    }
    button.nav {
      background:none; border:none; font-size:1.5rem;
      cursor:pointer; color:#555;
    }
    #month-year { cursor:pointer; font-weight:bold }

    .weekdays {
      display:grid; grid-template-columns:repeat(7,1fr);
      margin-top:2rem; margin-bottom:1rem;
    }
    .weekdays div {
      text-align:center; padding:0.5rem 0;
    }
    .weekdays .sun { color:#cd8d8d }
    .weekdays .sat { color:#7373b2 }
    .weekdays div:not(.sun):not(.sat) { color:#333 }

    #calendar {
      display:grid; grid-template-columns:repeat(7,1fr);
      gap:0; margin-bottom:1rem;
    }
    #calendar .placeholder {
      visibility:hidden; width:100%; aspect-ratio:1/1;
    }
    #calendar .day {
      width:100%; aspect-ratio:1/1;
      display:flex; align-items:center; justify-content:center;
      background:transparent; border:none; cursor:pointer;
      font-size:calc(1rem - 1pt); color:#333; position:relative;
    }
    #calendar .sun.day { color:#cd8d8d }
    #calendar .sat.day { color:#7373b2 }

    /* 생리 예상 기간 옅은 음영 */
    #calendar .day.period-range {
      background-color: var(--shade-period) !important;
    }
    /* 생리 시작/끝 원형 */
    #calendar .day.period-circle {
      background-color: var(--circle-color) !important;
      border-radius:50% !important;
    }
    /* 배란일 원형 */
    #calendar .day.ovulation-circle {
      background-color: var(--shade-ovulation) !important;
      border-radius:50% !important;
    }

    #message-box {
      text-align:center; font-size:0.9rem; color:#555;
      min-height:2em;
    }
  </style>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCpkhJyp2qPyr-duuda-VNeMj26YjfdjoM",
      authDomain: "nagi-cycle.firebaseapp.com",
      databaseURL: "https://nagi-cycle-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "nagi-cycle",
      storageBucket: "nagi-cycle.firebasestorage.app",
      messagingSenderId: "428094469503",
      appId: "1:428094469503:web:3c1e10b1fcb876077bd64a"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>
</head>
<body>
  <div class="wrapper">
    <header>
      <button class="nav" id="prev">&larr;</button>
      <div id="month-year"></div>
      <button class="nav" id="next">&rarr;</button>
    </header>
    <div class="weekdays">
      <div class="sun">SUN</div><div>MON</div><div>TUE</div>
      <div>WED</div><div>THU</div><div>FRI</div><div class="sat">SAT</div>
    </div>
    <div id="calendar"></div>
    <div id="message-box"></div>
  </div>

  <script>
    (() => {
      const CYCLE_LENGTH      = 28;
      const PERIOD_DAYS       = 6;   // 시작일 포함 7일간
      const OVULATION_OFFSET  = 14;  // 시작일로부터 14일째

      const periodMessages = [
        "몸이 차가워지기 쉬운 시기야. 따뜻한 차 등으로 혈액 순환을 도와줘.",
        "에너지 소모가 크니 무리하지 말고 충분히 쉬어.",
        "감정 기복이 있을 수 있어. 자신에게도 관대해져 봐.",
        "코어 근육 이완을 위해 가벼운 스트레칭이 도움이 될 거야.",
        "잘 먹고 잘 쉬는 것이 지금 가장 중요해.",
        "수분을 충분히 섭취하면 몸이 좀 더 편안해질 거야."
        “가벼운 요가나 스트레칭으로 부드럽게 흐름을 따라가 보자.”
	      “따뜻한 물로 샤워하거나 족욕을 하면 긴장이 풀리고 편안함이 찾아올 거야.”
	    	“이 시기엔 단백질 섭취를 조금 늘려주는 게 좋아. 콩류나 계란을 곁들여 봐.”
	    	“생리통이 심할 땐 몸을 따뜻하게 해주면 통증이 완화될 수 있어.”
	    	“감정이 예민해질 수 있지만, 스스로를 다독이며 작은 기쁨을 찾아봐.”
	      “초콜릿 한 조각과 따뜻한 차 한 잔, 아주 작은 것들도 충분히 가치 있어.”
	    	“몸이 보내는 신호에 귀 기울여, 무리하지 않는 선에서 스스로를 챙기자.”
	    	“좋아하는 음악을 틀어두고 잠시 눈을 감아도 좋아.”
      ];
      const ovulationMessages = [
        "배란일 전후에는 호르몬 변화가 활발해서 피부가 거칠어지기 쉬운 시기야.",
        "에너지 레벨이 상승하는 시기야. 가벼운 운동으로 활력을 느껴봐.",
        "정신이 맑아지는 때이니 하고 싶던 일을 시도해봐.",
        "호르몬 균형을 위해 단백질 섭취에 주의를 기울여.",
        "감정이 예민해질 수 있어. 자기 자신에게 친절하게 대하길.",
        "자신감을 느끼기 좋은 시기야. 스스로를 응원해."
      ];

      const ref        = db.ref('cycleDates');
      let   dates      = [];
      let   view       = new Date();

      const elCalender = document.getElementById('calendar');
      const elMonth    = document.getElementById('month-year');
      const elMessage  = document.getElementById('message-box');
      const prevBtn    = document.getElementById('prev');
      const nextBtn    = document.getElementById('next');

      prevBtn.onclick = () => { view.setMonth(view.getMonth()-1); render(); };
      nextBtn.onclick = () => { view.setMonth(view.getMonth()+1); render(); };
      elMonth.onclick = () => { view = new Date(); render(); };

      ref.on('value', snap => {
        const val = snap.val() || {};
        dates = Object.keys(val).filter(k => /^\d{4}-\d{2}-\d{2}$/.test(k)).sort();
        render();
      });

      function toDateStr(d) {
        return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
      }

      function render() {
        const year = view.getFullYear(), month = view.getMonth();
        elMonth.textContent = `${year}년 ${month+1}월`;
        elCalender.innerHTML = '';

        // 빈 칸
        const firstDay = new Date(year,month,1).getDay();
        for (let i=0; i<firstDay; i++) {
          const ph = document.createElement('div');
          ph.classList.add('placeholder');
          elCalender.appendChild(ph);
        }

        const daysInMonth = new Date(year,month+1,0).getDate();
        const now = new Date();

        for (let d=1; d<=daysInMonth; d++) {
          const btn = document.createElement('button');
          btn.classList.add('day');
          const ds = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
          btn.textContent = d;

          const weekday = new Date(year,month,d).getDay();
          if (weekday === 0) btn.classList.add('sun');
          else if (weekday === 6) btn.classList.add('sat');

          const cellTime = new Date(year,month,d).getTime();

          dates.forEach(startStr => {
            const st = new Date(startStr).getTime();
            const endSt = st + PERIOD_DAYS * 86400000;
            const ov  = st + OVULATION_OFFSET * 86400000;

            // 생리기간 음영
            if (cellTime >= st && cellTime <= endSt) {
              btn.classList.add('period-range');
            }
            // 생리 시작/끝 원
            if (cellTime === st || cellTime === endSt) {
              btn.classList.add('period-circle');
            }
            // 배란일 원
            if (cellTime === ov) {
              btn.classList.add('ovulation-circle');
            }
          });

          btn.onclick = () => {
            if (dates.includes(ds)) {
              ref.child(ds).remove();
            } else {
              ref.child(ds).set(true);
            }
          };

          elCalender.appendChild(btn);
        }

        // 메시지
        let msg = '';
        dates.forEach(startStr => {
          const st = new Date(startStr).getTime();
          const endSt = st + PERIOD_DAYS * 86400000;
          const ov  = st + OVULATION_OFFSET * 86400000;

          if (now.getTime() >= st && now.getTime() <= endSt) {
            msg = periodMessages[Math.floor(Math.random()*periodMessages.length)];
          } else if (toDateStr(now) === toDateStr(new Date(ov))) {
            msg = ovulationMessages[Math.floor(Math.random()*ovulationMessages.length)];
          }
        });
        elMessage.textContent = msg;
      }
    })();
  </script>
</body>
</html>
